<!DOCTYPE html><html>
	<head>
		<meta charset="utf-8" />
		<meta content="yes" name="apple-mobile-web-app-capable" />
		<meta content="FqZmg6H3v_nmsp9fiNgPYGahHNM5GZHxomGGCYO0Dfo" name="google-site-verification" />
		<meta content="This tool allows you to play any Hopscotch project, regardless of whether or not it is published, filtered, or custom data." name="description" />
		<link rel="icon" type="image/png" sizes="32x32" href="/hs-tools/icons/favicon-32x32.png">
		<link rel="icon" type="image/png" href="https://aws1.discourse-cdn.com/gethopscotch/original/3X/3/8/3836ff26c18740a553e96462dc1ece3d8e7f4869.png">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		<link rel="apple-touch-icon" sizes="180x180" href="/hs-tools/icons/apple-touch-icon.png">
		<link rel="icon" type="image/png" sizes="32x32" href="/hs-tools/icons/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/hs-tools/icons/favicon-16x16.png">
		<link rel="manifest" href="/hs-tools/icons/site.webmanifest">
		<link rel="mask-icon" href="/hs-tools/icons/safari-pinned-tab.svg" color="#5bbad5">
		<link rel="shortcut icon" href="/hs-tools/icons/favicon.ico">
		<meta name="apple-mobile-web-app-title" content="Hopscotch Tools">
		<meta name="application-name" content="Hopscotch Tools">
		<meta name="msapplication-TileColor" content="#da532c">
		<meta name="msapplication-config" content="/hs-tools/icons/browserconfig.xml">
		<meta name="theme-color" content="#ffffff">
		<title>Loading...</title>
		<meta content="summary_large_image" name="twitter:card" />
		<meta content="617098629" name="twitter:app:id:iphone" />
		<meta content="617098629" name="twitter:app:id:ipad" />
		<meta content="US" name="twitter:app:country" />
		<meta content="@hopscotch" name="twitter:site" />
		<meta content="Play a Hopscotch Project" name="twitter:title" />
		<meta content="This tool allows you to play any Hopscotch project, regardless of whether or not it is published, filtered, or custom data." name="twitter:description" />
		<meta content="website" property="og:type" />
		<meta content="Awesome_E's Hopscotch Tools" property="og:site_name" />
		<meta content="Play a Hopscotch Project" property="og:title" />
		<meta content="This tool allows you to play any Hopscotch project, regardless of whether or not it is published, filtered, or custom data." property="og:description" />
		<meta content="/hs-tools/images/hs-logo-h.png"" property="og:image" /> <!--AE_MOD -->
		<meta content="width=device-width,initial-scale=1,user-scalable=no,maximum-scale=1" name="viewport" />
		<link rel="stylesheet" media="screen" href="application.css" />
		<meta name="csrf-param" content="authenticity_token" />
		<meta name="csrf-token" content="Xonf2Bn4pgVRZobpf3Nfuzvd7P3rCyCySJSHi4S9XQRNoKQiOrWClrrw8ll6ZBVi/p6ryAbAAhOvDCMEw9VlOw==" />
		<noscript><link href="https://fast.fonts.net/cssapi/8241d903-e7fe-4a18-8a4d-2d6414db23d8.css" rel="stylesheet" type="text/css" /></noscript>
		<link id="fontcss"></link>
		<script>/*LazyLoad CSS*/setTimeout(function(){document.getElementById("fontcss").href="https://fast.fonts.net/cssapi/8241d903-e7fe-4a18-8a4d-2d6414db23d8.css"},100)</script>
		<!-- AE MOD -->
		<script src="../main.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<style>
			@media print {
				body {font-family:sans-serif;background-color:red!important;}
				h1, h2 {color:black!important;}
				#projectInfoHoverIcon {display:none;}
				.wrapper {display:none;}
				.review-card b {display:inline-block; margin:12px 0 5px;}
				.review-date {display:block;margin-top:5px;}
				.review-date::before {content:"Review Date: "}
			}
		</style>
		<!-- AE MOD -->
	</head>
</html>

<body class="project webplayer embedded">
	<div class="wrapper"><div class="content" id="body_content">

	<script id="svgInsert" src="https://awesome-e.github.io/hs-tools/play-project/html_svg.js"></script>
	<!-- The core Firebase JS SDK is always required and must be listed first -->
	<script src="https://www.gstatic.com/firebasejs/7.14.2/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/7.14.2/firebase-auth.js"></script>
	<script src="https://www.gstatic.com/firebasejs/7.14.2/firebase-database.js"></script>
	<script>
	
		var projectImport = projectImport || {};
		var AE_MOD = {
			"projectData": {},
			"uuid": "",
			"playerVersion": "",
			"moddedActions": {
				keyboardSupport: false,
				hasUrl: false
			},
			"pendingHostList":[],
			"webplayer_action": function(a, b, c) {
				isTrusted = !AE_MOD.isCustom;
				if (!typeof c == "object" || !/^.{1,3}$/.test(Object.getPrototypeOf(c||{}).constructor.name)) isTrusted = false, console.warn("Untrusted Event");
				try {
					a = JSON.parse(a.replace(/"_data"/g,b));
					a.args = a.args || [];
				} catch (e) {
					console.error("Invalid webplayer action:" + a);
					return;
				}
				switch (a.name) {
					case "restart":
						document.getElementById("restart-button").click();
						break;
					case "js-console-log":
						console.log('%cAwesome_Eâ€™s Project Player%c ' + a.args, 'display:block; padding: 4px 6px; background-color: salmon; color: white; font-weight: bold;','');
						break;
					case "js-alert":
						alert(a.args);
						break;
					case "js-prompt":
						return prompt(a.args[0],(a.args[1]||""));
					case "checkKey":
						return Number(a.args.repeatEach(function(k){
							return AE_MOD.keyboardKeys.includes(k);
						}).includes(true));
					case "checkKeyData":
						return Number(AE_MOD.keyboardKeys.includes(b));
					case "checkKeyAll":
						return Number(!a.args.repeatEach(function(k){
							return AE_MOD.keyboardKeys.includes(k);
						}).includes(false));
					case "scrollData":
						return AE_MOD.mouseWheelData[a.args[0]];
					case "isWebExp":
						return 1;
					case "isComputer":
						return Number(!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&!(navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1));
					case "user-tz":
						return Math.round(new Date().getTimezoneOffset()/-60);
					case "savedata-write":
						if (LS_ACCESS) {
							localStorage.setItem("pData_"+AE_MOD.uuid, a.args.join(""));
							return 1;
						} else {
							alert("Unable to save data. Make sure third-party cookies are allowed for awesome-e.github.io so that the project has access to local storage");
							return 0;
						}
					case "savedata-read":
						if (!LS_ACCESS) return alert("Save data cannot be accessed within this frame."), 0;
						function maskedEval(scr) {
							var mask = {data:localStorage.getItem("pData_" + AE_MOD.uuid)};
							for (p in this) mask[p] = undefined;
							
							return (new Function( "with(this) { return eval(" + JSON.stringify(scr) + ") }")).call(mask);
						}
						try {return maskedEval(a.args.join(""));}catch(e){return 0;}
						break;
					case "globalvar-load":
						if (!a.args[0] && a.args[0] !== 0) break; //No Empty Keys
						//AE_MOD.globalvars[a.args[0]] = NaN;
						XHR.requestExt("GET","https://enbvba4agagutp9.m.pipedream.net/aehstools/get?access_token=aehstools&key="+(AE_MOD?.projectData?.user?.id||-1)+"-"+(a.args[0]||""),function(r,s){
							try {
								JSON.parse(r);
								AE_MOD.globalvars[a.args[0]] = JSON.parse(r).value;
							} catch (e) {/* Bad JSON */ AE_MOD.globalvars[a.args[0]] = "__ERR_CANNOT_GET"}
						})
						break;
					case "globalvar-read":
						return AE_MOD.globalvars[a.args[0]];
						break;
					case "globalvar-write":
						XHR.requestExt("GET","https://enbvba4agagutp9.m.pipedream.net/aehstools/set?access_token=aehstools&value="+a.args[1]+"&key="+(AE_MOD?.projectData?.user?.id||-1)+"-"+(a.args[0]||""),function(r,s){
							try {
								JSON.parse(r);
								AE_MOD.globalvars[a.args[0]] = JSON.parse(r).value;
							} catch (e) {/* Bad JSON */}
						})
						break;
					case "url-iframe":
						function onList(hostname){
							return !!hostname.match(new RegExp("^("+AE_MOD.approvedHostList.join("|").replace(/\*/g,".*?")+")$"));
						}
						if (a.args[0]) {
							try {
								host = new URL(a.args[0]).host;
								origin = new URL(a.args[0]).origin;
								if (host && !onList(host)) {
									if (AE_MOD.pendingHostList.indexOf(origin) == -1) AE_MOD.pendingHostList.push(origin);
									return alert("This URL has not been approved");
								}
							} catch (e) {return alert("Invalid URL")}
							let parentDiv = document.getElementById("projectIframeDiv");
							let iframe = parentDiv.querySelector("iframe") || document.createElement("iframe");
							iframe.src = (a.args[0].match(/^https?:\/\/.*?\.github\.io|data:/))?a.args[0]:"https://api.allorigins.win/raw?url="+encodeURIComponent(a.args[0]);
							parentDiv.appendChild(iframe);
							parentDiv.style.bottom = 0;
							if (!parentDiv.querySelector("button").onclick) parentDiv.querySelector("button").onclick = function(){
								parentDiv = document.getElementById("projectIframeDiv");
								parentDiv.style.bottom = "-100vh";
								setTimeout(()=>{parentDiv.querySelector("iframe").remove();},1000);
							}
						}
						break;
					case "url-goto":
						function onList(hostname){
							return !!hostname.match(new RegExp("^("+AE_MOD.approvedHostList.join("|").replace(/\*/g,".*?")+")$"));
						}
						if (a.args[0]) {
							try {
								host = new URL(a.args[0]).host;
								origin = new URL(a.args[0]).origin;
								if (host && !onList(host)) {
									if (AE_MOD.pendingHostList.indexOf(origin) == -1) AE_MOD.pendingHostList.push(origin);
									return alert("This URL has not been approved");
								}
							} catch (e) {return alert("Invalid URL")}
							location.href = a.args[0];
						}
						break;
					case "achievement":
						var target = document.getElementById("achievement-banner");
						target.innerHTML = "";
						target.innerHTML = a.args[0];
						banner(true);
						break;
					case "session-new":
						if (!isTrusted) alert("Cannot start session: untrusted code execution");
						if (session.gameId && session.isHost) {
							if (!confirm("Your current session (" + session.gameId + ") is still active! Would you like to create a new session anyways?")) break;
							session.leave();
						} else if (session.gameId) {
							if (!confirm("You are currently in a session (" + session.gameId + ")! Are you sure you want to leave?")) break;
							session.leave();
						}
						session.isHost = true;
						session.maxSize = Number(a.args[0])||256;
						session.gameId = Math.round(Math.random()*36**6).toString(36);
							var now = Math.round(Date.now()/1000).toString(36);
							session.userJoined = now + session.userId;
						firebase.database().ref("live-projects/"+AE_MOD.projectData.uuid+"-"+session.gameId).set({
							"createdAt": new Date().toISOString(),
							"canJoin": true,
							"maxSize": session.maxSize
						});
						firebase.database().ref("live-projects/"+AE_MOD.projectData.uuid+"-"+session.gameId+"/users/"+session.userJoined).set(true);
						copyText(session.gameId);
						setTimeout(function(){alert("Session ID copied to clipboard: " + session.gameId)},10);
						
						firebase.database().ref("live-projects/"+AE_MOD.projectData.uuid+"-"+session.gameId).on("value",function(s){
							if (session.userJoined) session.data = s.val();
						});
						return session.gameId;
						break;
					case "session-join":
						if (!isTrusted) alert("Cannot join session: untrusted code execution");
						if (session.gameId && session.isHost) {
							if (!confirm("Your current session (" + session.gameId + ") is still active! Would you like to join a new session anyways?")) break;
							session.leave();
						} else if (session.gameId) {
							if (!confirm("You are currently in a session (" + session.gameId + ")! Are you sure you want to leave?")) break;
							session.leave();
						}
						session.gameId = (prompt("Enter Session ID:")||"").toLowerCase().replace(/[\s\-\.#\$\[\]]/g,"");
						if (session.gameId) {
							var now = Math.round(Date.now()/1000).toString(36);
							session.userJoined = now + session.userId;
							firebase.database().ref("live-projects/"+AE_MOD.projectData.uuid+"-"+session.gameId).once("value").then(s=>{
								if (s.val() && Object.keys(s.val().users||{}).length < s.val().maxSize) {
									firebase.database().ref("live-projects/"+AE_MOD.projectData.uuid+"-"+session.gameId+"/users/"+session.userJoined).set(false);
									firebase.database().ref("live-projects/"+AE_MOD.projectData.uuid+"-"+session.gameId).on("value",function(s){
										if (session.userJoined) session.data = s.val();
										if(!s.val()||!s.val().users) {
											if (!s.val() && session.userJoined) alert("The host has ended the session");
											session.leave();
										}
									});
								} else {
									alert(s.val()?"The session is full":"No such session exists");
									session.leave();
								}
							});
						}
						break;
					case "session-read":
						if (!session.data) break;
						if (!isTrusted && (!session.data || !session.data.users[session.getUser(-1)])) alert("Cannot simulate read: untrusted non-host code execution");
						try {return eval(a.args.join(""));}catch(e){return 0;}
					case "session-write":
						if (!session.data || !session.gameId || !session.data.users) break;
						if (!isTrusted && session.getUser(-1) !== session.getUser(0)) alert("Cannot write code: untrusted code execution");
						try {
							firebase.database().ref("live-projects/"+AE_MOD.projectData.uuid+"-"+session.gameId+"/game/"+session.getUser(a.args[0])+"/"+a.args[1]).set(
								a.args[2]
							);
						} catch (e) {
							return 0;
						}
						break;
					case "session-myindex":
						if (!session.data) return 0;
						try {return session.getUser(-1, true);}catch(e){return 0;}
					case "session-open":
						if (!isTrusted && (!session.data || session.getUser(-1) !== session.getUser(0))) alert("Could not open session");
						firebase.database().ref("live-projects/"+AE_MOD.projectData.uuid+"-"+session.gameId+"/canJoin").set(true);
						break;
					case "session-close":
						if (!isTrusted && (!session.data || session.getUser(-1) !== session.getUser(0))) alert("Could not close session");
						firebase.database().ref("live-projects/"+AE_MOD.projectData.uuid+"-"+session.gameId+"/canJoin").set(true);
						break;
					case "session-leave":
						session.leave();
						break;
					default:
						console.error("Unknown webplayer action:", a)
				}
			},
			"load_function": function() {
				//var url = new URL(location.href);
				if (new URL(location.href).searchParams.get("from") == "hsBuilder") {
					localStorage.setItem("projectLoadState", "loaded");
				}
			},
			"globalvars": {},
			"initiated": false
		};
		
		/* */
		
		var BASE_IMAGE_URL = 'https://hopscotch-images.s3.amazonaws.com/production/images/project-images/';
		var HS_INDEX_PATH = "https://d3nbkco6xo1vz0.cloudfront.net/production/";
		var HS_WEBPLAYER_VERSION = AE_MOD.playerVersion;
		function init() {
			AE_MOD.initiated = true;
			AE_MOD.customCustomObjects = [];
			showProjectData(AE_MOD.projectData);
			(AE_MOD.projectData.abilities||[]).forEach(a=>{
				for (i = 0; i < (a.blocks||[]).length; i++) {
					b = a.blocks[i];
					//Lazy Check Each block
					if (JSON.stringify(b).match(/"type":22[^\{\}]*?"param(s|eters)?":\[\{[^\{\}]*?"value":"_ae_webplayer_action:\{.*?\\"name\\":\\"checkKey(All|Data)?\\".*?\}.*?\]\}/)) AE_MOD.moddedActions.keyboardSupport = true, document.querySelector(".play-button").classList.add("has-keyboard");
					//Lazy Check for URLs to check the filter
					if (JSON.stringify(b).match(/"type":22[^\{\}]*?"param(s|eters)?":\[\{[^\{\}]*?"value":"_ae_webplayer_action:\{.*?\\"name\\":\\"url-(iframe|goto)\\".*?\}.*?\]\}/)) AE_MOD.moddedActions.hasUrl = true;
					//Custom Custom
					let matchedValues = (JSON.stringify(b).match(/("value":"((?:|[^\{\}\[\]]*?[^\\])(?:\\\\)*)"[^\{\}\[\]]*?"datum":\{[^\{\}\[\]]*?"type":2000)/g)||[""])
						.join("\n").replace(/^.*?"value":"((?:|.*?[^\\])(?:\\\\)*)".*$|^.*$/,"$1\n")
						.replace(/\n$/,"");
					if (matchedValues) matchedValues.split("\n").forEach(match=>{ /\}/;
							console.log('%cMatched Custom Block:','color:green');
							console.log(b);
							a.blocks[i] = JSON.parse( JSON.stringify(b).replace(/("value":"((?:|[^\{\}\[\]]*?[^\\])(?:\\\\)*)"[^\{\}\[\]]*?"datum":\{[^\{\}\[\]]*?"type":2000)/g,'$1,"customObject":"$2"') ); /\}/;
							if (!match || !/\//.test(match) || AE_MOD.customCustomObjects.indexOf(match) !== -1) return;
							AE_MOD.customCustomObjects.push(match);
							const newCustomObj = {
								size: {
									width: Number(match.split("/")[0]),
									height: Number(match.split("/")[1])
								},
								id: match,
								fileName: match.split("/").splice(2).join("/")
							};
							(AE_MOD.projectData.customObjects||[]).push(newCustomObj);
						});
				};
			});
			delete AE_MOD.customCustomObjects;
			if (AE_MOD.moddedActions.hasUrl) XHR.requestExt("GET","https://enw6yiuqc2jyb5w.m.pipedream.net/play-project/approved-urls",function(r){
				try{AE_MOD.approvedHostList=JSON.parse(r)}catch(e){}
			});
			document.getElementById('hopscotch-link').href = "https://c.gethopscotch.com/p/" + AE_MOD.uuid;
			BASE_IMAGE_URL = "https://hopscotch-images.s3.amazonaws.com/production/images/project-images/";
			HS_INDEX_PATH = "https://d3nbkco6xo1vz0.cloudfront.net/production/";
			HS_WEBPLAYER_VERSION = AE_MOD.playerVersion;
			document.getElementById("appJs").src = "application.js"; // /*(location.protocol == "file:") ? "local_application.js" :*/ "https://awesome-e.github.io/hs-tools/play-project/application.js";
			var pTitle = AE_MOD.projectData.title||'Untitled';
			var pAuthor = (AE_MOD.projectData.user||{'nickname': AE_MOD.projectData.author}).nickname;
			var pTitleFull = pTitle + ((pAuthor == undefined) ? '' : ' by ' + pAuthor);
			document.title = pTitleFull;
			if (!AE_MOD.isCustom) {
				document.querySelector('#project-image').src = 'https://s3.amazonaws.com/hopscotch-cover-images/production/' + AE_MOD.uuid + '.png';
				document.querySelector('meta[property="og:image"]').setAttribute('content', 'https://s3.amazonaws.com/hopscotch-cover-images/production/' + AE_MOD.uuid);
			}
			document.querySelector('meta[property="og:title"]').setAttribute('content', pTitle);
			document.querySelector('meta[property="og:description"]').setAttribute('content', pTitleFull);
			document.querySelector('meta[name="twitter:title"]').setAttribute('content', pTitle);
			document.querySelector('meta[name="twitter:description"]').setAttribute('content', pTitleFull);
			document.querySelector('meta[name="description"]').setAttribute('content', pTitleFull);
		}
		
		/* */
		
		function doCORSRequest(options, printResult) {
			var x = new XMLHttpRequest();
			x.open(options.method, /*'https://cors-anywhere.herokuapp.com/'*/ 'https://api.allorigins.win/raw?url=' + encodeURIComponent(options.url));
			x.onload = x.onerror = function() { printResult(
					//options.method + ' ' + options.url + '\n' +
					//x.status + ' ' + x.statusText + '\n\n' +
					(x.responseText || '')
				);
			};
			if (/^POST/i.test(options.method)) {
			x.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
			}
			x.send(options.data);
		}
/*
		function request(input_url) {
			doCORSRequest({
				method: 'GET',
				url: input_url,
				//data: dataField.value
			}, function printResult(result) {
				try {
					var p = JSON.parse(result);
					AE_MOD.projectData = p;
					AE_MOD.uuid = p.uuid;
					AE_MOD.playerVersion = p.playerVersion||"1.0.0";
					AE_MOD.isCustom = false;
					//Authorize if Project contains session blocks.
					if (/_ae_webplayer_action:{\\"name\\":\\"session-/.test(result)) firebase.auth().signInAnonymously().catch(function(error) { /\}/;
						//Handle Errors here
						var errorCode = error.code;
						var errorMessage = error.message;
					});
					init();
				} catch (SyntaxError) {
					document.body.innerHTML = "<h2 style='display: block; width: 100%; text-align: center; position: fixed; top: calc(50% - 12px); font-size: 24px;'>Unable to load the project...</h2>";
					console.log('Unable to load');
					console.error(SyntaxError);
					return;
				}
				//OUTPUT
			});
		}*/
		
		function request(url) {
			XHR.requestExt("GET", url, function (result, status){
				try {
					var p = JSON.parse(result);
					console.log(p);
					AE_MOD.projectData = p;
					AE_MOD.uuid = p.uuid;
					AE_MOD.playerVersion = p.playerVersion||"1.0.0";
					AE_MOD.isCustom = false;
					//Authorize if Project contains session blocks.
					if (/_ae_webplayer_action:{\\"name\\":\\"session-/.test(result)) firebase.auth().signInAnonymously().catch(function(error) { /\}/;
						//Handle Errors here
						var errorCode = error.code;
						var errorMessage = error.message;
					});
					init();
				} catch (SyntaxError) {
					document.body.innerHTML = "<h2 style='display: block; width: 100%; text-align: center; position: fixed; top: calc(50% - 12px); font-size: 24px;'>Unable to load the project...</h2>";
					console.log('Unable to load');
					console.error(SyntaxError);
					return;
				}
				//OUTPUT
			}, (url.match(/awesome-e\.github\.io/)?0:1))
		}
		
		var url = new URL(window.location.href);
		var customUUID = url.searchParams.get("id");
		
		if (JSON.stringify(projectImport) != '{}' || (LS_ACCESS && localStorage.getItem("projectFromStorage") && url.searchParams.get("play") == 1)) {
			try {
				setTimeout(function(){
					if (!localStorage.getItem("projectFromStorage").match(/^\{/)) projectImport = JSON.parse(LZString.decompressFromUint8Array(new Uint8Array(localStorage.getItem("projectFromStorage").match(/[\w\d]{2}/g).repeatEach(val=>parseInt(val,16))))); /\}/;
					var p = JSON.stringify(projectImport) != '{}' ? projectImport : JSON.parse(localStorage.getItem("projectFromStorage"));
					//p = JSON.parse(localStorage.getItem("projectFromStorage"));
					AE_MOD.projectData = p;
					AE_MOD.uuid = p.uuid;
					AE_MOD.playerVersion = p.playerVersion||"1.0.0";
					AE_MOD.isCustom = true;
					if (new URL(location.href).searchParams.get("from") == "hsBuilder") localStorage.setItem("projectLoadState", "loadingPlayer");
					init();
				},200);
			} catch (SyntaxError) {
				document.body.innerHTML = "<h2 style='display: block; width: 100%; text-align: center; position: fixed; top: calc(50% - 12px); font-size: 24px;'>Unable to load the project...</h2>";
				console.error(SyntaxError);
			}
		} else {
			if (LS_ACCESS) localStorage.removeItem("projectFromStorage");
			var req_uuid = customUUID||(prompt('Project URL or UUID','')||'').replace(/.*\/p\//,'');
			if (req_uuid.match(/^\*/)) {
				request('https://awesome-e.github.io/hs-tools/play-project/dedicated-projects/' + req_uuid.replace(/^\*/,"") + ".hopscotch");
			} else {
				request('https://c.gethopscotch.com/api/v1/projects/' + req_uuid);
			}
			replaceLocation("?" + ((req_uuid) ? "id=" + req_uuid : "") + ((url.searchParams.get("play")=="1") ? "&play=1" : ""));
		}
		
		function banner(open){
			var b = document.querySelector(".achievement-banner");
			if (!b.innerHTML) return;
			if (open) {
				b.style.animationName = "banner-in";
				b.style.top = "8px";
			} else {
				b.style.animationName = "banner-out";
				b.style.top = "-96px";
			}
		}
		
		var firebaseConfig = {
			apiKey: "AIzaSyD875SNjpnaKUFFk7c3aR1PCb0RLDmhct0",
			authDomain: "ae-hs-tools.firebaseapp.com",
			databaseURL: "https://ae-hs-tools.firebaseio.com",
			projectId: "ae-hs-tools",
			storageBucket: "ae-hs-tools.appspot.com",
			messagingSenderId: "308306472112",
			appId: "1:308306472112:web:60bfcd36fca7d9723a9f75",
			measurementId: "G-XQBHQKPNWK"
		};
		// Initialize Firebase
		firebase.initializeApp(firebaseConfig);
		
		var session = {
			isHost: false,
			userId: null,
			gameId: null,
			maxSize: 256,
			leave: function(){
				if (session.gameId && session.isHost) firebase.database().ref("live-projects/"+AE_MOD.projectData.uuid+"-"+session.gameId).remove();
				else if (session.gameId){
					firebase.database().ref("live-projects/"+AE_MOD.projectData.uuid+"-"+session.gameId+"/game/"+session.userJoined).remove();
					firebase.database().ref("live-projects/"+AE_MOD.projectData.uuid+"-"+session.gameId+"/users/"+session.userJoined).remove();
				}
				session.isHost = false;
				session.gameId = null;
				if (session.data) session.data = null;
				if (session.userJoined) session.userJoined = null;
			},
			getUser: function(u, id_not_string){
				try {
					if (u == -2) return "";
					if (u == -1) u = Object.keys(session.data.users).sort().indexOf(session.userJoined);
					return (id_not_string) ? u : Object.keys(session.data.users)[u];
				} catch (e) {
					return "error";
				}
			}
		};
		firebase.auth().onAuthStateChanged(function(user) {
		  if (user) {
			// User is signed in
			var isAnonymous = user.isAnonymous;
			session.userId = user.uid;
			//Leave if restart
			document.getElementById("restart-button").addEventListener("click",function(){
				session.leave();
			});
			document.getElementById("restart-button").addEventListener("touchstart",function(){
				session.leave();
			});
		  } else {
			// User is signed out
		  }
		  // ...
		});
		document.body.onunload = function(){
			session.leave();
			if (AE_MOD.pendingHostList.length > 0) navigator.sendBeacon("https://enw6yiuqc2jyb5w.m.pipedream.net/play-project/approved-urls",JSON.stringify({"urls":AE_MOD.pendingHostList}));
		};
		document.body.onblur = function(){
			if (!session.data || !session.gameId || !session.data.users) return;
			firebase.database().ref("live-projects/"+AE_MOD.projectData.uuid+"-"+session.gameId+"/game/"+session.getUser(-1)+"/lastInactive").set(new Date().toISOString());
		};
		document.body.onfocus = function(){
			if (!session.data || !session.gameId || !session.data.users) return;
			firebase.database().ref("live-projects/"+AE_MOD.projectData.uuid+"-"+session.gameId+"/game/"+session.getUser(-1)+"/lastInactive").set(null);
		};
		
		document.body.addEventListener("keydown",function(e){
			//Play the project using the space bar
			if (e.keyCode == 32 && document.getElementById('play_container')?.style.display == "block") document.getElementById('play_container').click();
		})
		
	</script>

	<div id="ae-hs-player">
		<div class="player-icon-toolbar" ondragstart="event.preventDefault();">
			<img alt="mute" id="mute-button" class="player-icon" src="assets/speaker.svg" asrc="https://c.gethopscotch.com/assets/webplayer/speaker-9713bf0a2c5e18bbcf82ff55b8b02a23c2feeb26fe4e18c2c2b96986856e3a42.svg" />
			<img alt="replay" id="restart-button" class="player-icon" src="assets/refresh_button.svg" asrc="https://c.gethopscotch.com/assets/webplayer/refresh_button-5a6475850ec2e0b6a9dd0df4a26cfcd2ddc6cf79c858b931df8534d4be6bb67e.svg" />
			<img alt="fullscreen" id="fullscreen-button" class="player-icon" src="assets/fullscreen_button.svg" asrc="https://c.gethopscotch.com/assets/webplayer/fullscreen_button-e27fd53c82e53e33b0c77ccad29570543d1060028d4b1ab26521cf9a09cedd4b.svg" />
			<a id="hopscotch-link" target="_top" onclick="event.preventDefault();">
				<img alt="hopscotch" id="hopscotch-button" class="player-icon" src="assets/hopscotch_button.svg" asrc="https://c.gethopscotch.com/assets/webplayer/hopscotch_button-a64dbfaa6e5b9f817bb28c67cf5dcf6741aac3034464d3305065f1edb6a97617.svg" />
			</a>
		</div>
		<div id="achievement-banner" class="achievement-banner"></div>
		<div id="projectIframeDiv"><button class="hs-style-btn"><i class="fa fa-close"></i></button></div>
		<hopscotch-player id="player" width="Infinity">
		<div id="project_error"><div class="project_error_message"><h2>Sorry, try again later.</h2>
		<script>
		((getPref("replace_fullscreen")||/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) ? document.getElementById("fullscreen-button"):document.getElementById("hopscotch-link")).style.display = "none";
		
		setTimeout(function() {
			if (!window.main) {
				project_loading.style.display = 'none';
				project_error.style.display = 'block';
			}
		}, 30000);
		
		document.body.style.backgroundColor = (getPref("dark_mode")) ? "black" : "";
		document.body.style.backgroundColor = (getPref("dark_mode")) ? "black" : "";
		setTimeout(function(){document.getElementById("project_loading").style.filter = "invert(" + Number(getPref("dark_mode")) + ")";},50);
			
		//When Escape is pressed, close the player if it is embedded in the web explorer
		document.body.addEventListener("keydown", function(e) {
			if (e.keyCode == 27 && window.frameElement && !window.fullScreen && !(top.innerWidth == screen.width && top.innerHeight == screen.height) && self !== top && top.document.getElementById("close-player-btn")) {
				top.document.getElementById("close-player-btn").click();
			}
		});
		</script></div></div>

		<div class="row content" id="play_container_row"><img id="project_loading" src="https://c.gethopscotch.com/assets/webplayer/loading_apple-05eb745176d79ec27d52d544582483fc4d0f6378c7ed2060be24dfc4e8990668.gif" /><div id="play_container" style="display:none"><div id="play_container_bg"></div><img id="project-image" /><a id="play" class="pos-abs" href="#"><div class="play-button teal-button"><span class="triangle"></span></div></a></div></div>
		
		</hopscotch-player>
	</div>
	
	</div></div>
	
	<div id="projectInfoDiv" onmouseenter="this.style.animationName='none',this.classList.add('open')" onmouseleave="this.classList.remove('open')">
		<div id="projectInfoHoverIcon"><i class="fa fa-info"></i></div>
		<div id="projectInfoHoverPanel"></div>
		<div id="projectInfoContent">
			<h2 style="color:white;text-align:center;">Project Info</h2>
			<span id="projectInfoText"><br/><span style="width:100%;display:block;text-align:center;font-size:16px;">Loading...</span></span><br/><br/>
			<h4 style="text-align:center;">Reviews</h4>
			<div id="projectInfoReviews">
				<br/>Loading...
			</div>
		</div>
	</div>
	<script>
		//Project Info Script
		function showProjectData(p) {	
			var r = Math.round(JSON.stringify(p).length/10)/100;
			var customDescription = (p.objects.filter(o=>{return o.name == 'AE.webInfoText'})[0]||{}).text;
			var infoTexts = "\nTitle: " + p.title +
							"\nPublished: " + !!(p.correct_published_at&&!p.deleted_at) + ", Filtered: " + p.has_been_removed +
							(p.correct_published_at?"\nPublish Time: " + (p.correct_published_at||"").replace("T", " at ").replace("Z", " GMT"):"") +
							`\nMade by: ${p.user?p.user.nickname:p.author}\u202D (user id: ${(p.user != undefined) ? p.user.id : 'unknown'}) ` + 
							((p.original_user != undefined && p.original_user.id != p.user.id) ? `\nRemixed from: ${p.original_user.nickname}\u202D (user id: ${p.original_user.id}) ` : '') +
							"\nProject UUID: " + p.uuid +
							"\nFile ID: " + (p.filename||'').replace(/\.hopscotch/, '') + " (" + ((r < 1000) ? r + "KB)" : Math.round(r/10)/100 + "MB)") +
							"\nLikes: " + p.number_of_stars + ", Play Count: " + p.play_count +
							"\nRemixes: " + p.project_remixes_count + ", Published Remixes: " + p.published_remixes_count +
							"\nAbout 1 like per " + Math.round((p.play_count||1)/p.number_of_stars||0) + " plays (" + (Math.round(p.number_of_stars/p.play_count*10000)/100||0) + "%)" +
							"\n" + (Math.round(p.published_remixes_count/(p.published_remixes_count+p.project_remixes_count)*10000)/100||0) + "% of remixes are published" +
							"\nVersion: Editor " + p.version + ", Player " + (p.playerVersion||'1.0.0') + " (" + Object.keys(p.playerUpgrades||{}).length + " upgrades)" +
							"\nNumber of Scenes: " + (p.scenes||'_').length + ", Number of Objects: " + p.objects.length +
							"\n" + p.rules.length + " rules, " + p.abilities.length + " abilities, " +
							(function(){var blocks = 0; p.abilities.forEach((x)=>{blocks += (x.blocks||[]).length;});return blocks;})() + " blocks" +
							"\nNumber of Variables: " + (p.variables||'').length + ", Custom Images: " + (p.customObjects||'').length +
							"\nObject Scale: " + (p.baseObjectScale||1) + ", Font Size: " + (p.fontSize||80) + ", Stage: " + (p.stageSize||{"width": 1024}).width + "x" + (p.stageSize||{"height": 768}).height +
							(customDescription ? "\nCustom Description: " + customDescription : "");
			document.getElementById("projectInfoText").innerHTML = infoTexts.replace(/\n/g,"<br/>");
			XHR.get("https://ae-hs-tools.firebaseio.com/project-reviews/" + p.uuid + ".json", function(r,s) {
				if (s !== 200) return document.getElementById("projectInfoReviews").innerHTML = "<br/>There was an error loading reviews for this project";
				if (r == "null") return document.getElementById("projectInfoReviews").innerHTML = "<br/>No Reviews Yet";
				try {JSON.parse(r)}catch(e){return document.getElementById("projectInfoReviews").innerHTML = "<br/>There was an error loading reviews for this project";}
				let reviews = JSON.parse(r);
				document.getElementById("projectInfoReviews").innerHTML = "";
				Object.keys(reviews).sort().reverse().forEach(key=>{
					let reviewdata = reviews[key];
					let reviewcard = document.createElement("div");
					let reviewtime = new Date(Number(key));
					console.log(reviewtime);
					let timestring = ["January","February","March","April","May","June","July","August","September","October","November","December"][reviewtime.getMonth()]+" "+String(reviewtime.getDate())+", "+String(reviewtime.getFullYear());
					reviewcard.classList.add("review-card");
					reviewcard.innerHTML = (reviewdata.rating!=null?'<span class="rating">'+reviewdata.rating+' <i class="fa fa-star-o"></i></span>':'')
						+ '<b>'+reviewdata.author+'<span style="position:relative;top:-1.05px;left:0.6px;font-size:16px;">:</span></b>'
						+ '<br/>&ldquo;<i>'+reviewdata.review+'</i>&thinsp;&rdquo;'
						+ '<span class="review-date">'+timestring+'</span>'
					document.getElementById("projectInfoReviews").appendChild(reviewcard);
				});
			}, false);
		}
		document.addEventListener("touchstart",e=>{
			let infoDiv = document.getElementById("projectInfoDiv");
			if (infoDiv.contains(e.target)) {
				infoDiv.classList.add("open");
				infoDiv.style.animationName = "none";
			} else {
				infoDiv.classList.remove("open");
			}
		});
	</script>
	<!-- script src="https://c.gethopscotch.com/assets/application-1a9cf5388bffbc24dfa2009d5e1bc56240d420916697f2f5fe7ed22d96ce3733.js"></script-->
	<script id="appJs"></script>
	<script src="asset_urls.js"></script>

	<!-- script>$('a').on('touchstart', function() { window.location = this.href; });</script -->
</body>