<!doctype html>
<html>
	<head>
		<title>Corona Virus Quick Stats</title>
	</head>
	<body>
		<span id="output">
			
		</span>
		<script>
			javascript: function doCORSRequest(options, printResult) {
				var x = new XMLHttpRequest();
				x.open(options.method, '' + options.url);
				x.onload = x.onerror = function() {
					if (x.status == 429 || x.status == 403) target.value = "Server Error (" + x.status + ") %C3%A2%E2%82%AC%E2%80%9C Try again later.";
					else printResult((x.responseText || ''))
				};
				if (/^POST/i.test(options.method)) {
					x.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')
				}
				x.send(options.data)
			}

			function request(input_url, print) {
				doCORSRequest({
					method: 'GET',
					url: input_url,
				}, print)
			};
			request("https://services1.arcgis.com/0MSEUqKaxRlEPj5g/arcgis/rest/services/ncov_cases/FeatureServer/1/query?f=json&where=1%3D1&returnGeometry=false&spatialRel=esriSpatialRelIntersects&outFields=*&orderByFields=Confirmed%20desc%2CCountry_Region%20asc%2CProvince_State%20asc&outSR=102100&resultOffset=0&resultRecordCount=250", function(r) {
				var stats = {
					"confirmed": 0,
					"deaths": 0,
					"recovered": 0
				};
				JSON.parse(r).features.forEach((i) => {
					stats.deaths += i.attributes.Deaths || 0;
					stats.recovered += i.attributes.Recovered || 0;
					stats.confirmed += i.attributes.Confirmed || 0
				});
				document.getElementById("output").innerHTML = "Confirmed Cases: " + stats.confirmed + "<br/>Deaths: " + stats.deaths + "<br/>Recovered: " + stats.recovered;
			})
		</script>
	</body>
</html>
